import{_ as a}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as e,b as n}from"./app-DrsE8OIX.js";const l="/work-blog/assets/iptables-DR5MSnsZ.png",t="data:image/png;base64,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",i={},p=n('<h2 id="iptables的基本原理" tabindex="-1"><a class="header-anchor" href="#iptables的基本原理"><span>iptables的基本原理</span></a></h2><h3 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h3><p>我们通常所说的<code>iptables</code>严格来讲应该叫做<code>Netfilter</code>，<code>Netfilter</code>是一种内核防火墙框架，可以实现很多网络安全策略，包括数据包过滤、数据包处理、地址伪装、透明代理、网络地址转换等。<code>iptables</code>则是一个应用层的二进制工具，可以基于<code>Netfilter</code>接口设置内核中的<code>Netfilter</code>配置表。</p><p><code>iptables</code>由表及构成表的链组成，每条链又由具体的规则组成。<code>iptables</code>内置4张表和5条链，4张表分别是<code>RAW</code>、<code>Mangle</code>、<code>NAT</code>、<code>Filter</code>表，5条链又叫作数据包的5个挂载点（Hook Point，可以理解为回调函数点，在数据包到达这些位置时，内核回主动调用回调函数，使得数据包在路由时可以改变方向或内容），分别是<code>PREROUTING</code>、<code>INPUT</code>、<code>OUTPUT</code>、<code>FORWORD</code>和<code>POSTROUTING</code>。对于不同表中相同类型的规则执行顺序，<code>iptabels</code>定义了优先级，该优先级由高到低排序为<code>raw</code>、<code>managle</code>、<code>nat</code>、<code>filter</code>。例如，对于<code>PREROUTING</code>链来说，首先执行<code>raw</code>表的规则，然后执行<code>mangle</code>表的规则，最后执行nat表的规则。</p><h3 id="iptables的表和链" tabindex="-1"><a class="header-anchor" href="#iptables的表和链"><span>iptables的表和链</span></a></h3><p>Filter表表示iptables的默认表，如果在创建规则时未指定表，那么默认使用<code>Filter</code>表，主要用于数据包过滤，根据具体规则决定是否放行该数据包（<code>DROP</code>、<code>ACCEPT</code>、<code>REJECT</code>、<code>LOG</code>等）。 Filter表包含如下三种内建链：</p><ul><li><code>INPUT</code>链：过滤目的地址是本机的所有数据包</li><li><code>OUTPUT</code>链：过滤本机产生的所有数据包</li><li><code>FORWARD</code>链：过滤经过本机的所有数据包（源地址和目的地址都不是本机）</li></ul><p>NAT表主要用于修改数据包的IP地址、端口号等信息，包含以下三种内建链</p><ul><li><code>PREROUTING</code>链：<code>DNAT</code>，处理刚到达本机并在路由转发前转换数据包的目的地址</li><li><code>POSTROUTING</code>链：<code>SNAT</code>，处理即将离开本机的数据包，转换数据包的源地址</li><li><code>OUTPUT</code>链：<code>MASQUERADE</code>，改变本机产生的数据包的源地址 主要用于修改数据包的TOS、TTL，以及为数据包设置Mark标记，以实现QoS调整及策略路由等。它包含所有5条内置规则链：<code>PREROUTING</code>、<code>POSTROUTING</code>、<code>INPUT</code>、<code>OUTPUT</code>、<code>FORWORD</code>。</li></ul><p><code>RAW</code>表是<code>iptables</code>在1.2.9版本之后新增的表，主要用于决定数据包是否被状态跟踪机制处理。RAW表的优先级要优于其他表，包含两条规则链：<code>OUTPUT</code>和<code>PREROUTING</code>。</p><h3 id="iptables原理图" tabindex="-1"><a class="header-anchor" href="#iptables原理图"><span>iptables原理图</span></a></h3><figure><img src="'+l+`" alt="iptables原理图" tabindex="0" loading="lazy"><figcaption>iptables原理图</figcaption></figure><p>上图展示了<code>iptables</code>规则链处理数据包的顺序，网卡接收的数据包会进入内核协议栈被<code>PREROUTING</code>规则链处理（可能发生数据包的目的地址转换），之后由内核协议栈进行路由选择，如果数据包的目的地址是本机，则内核协议栈会将其传给<code>INPUT</code>链处理，<code>INPUT</code>链在允许通过后，数据包由内核空间进入用户空间，被主机进程处理；如果<code>PREROUTING</code>链处理后的数据报的目的地址不是本机地址，则将其传给<code>FORWARD</code>链进行处理，最后交给<code>POSTROUTING</code>链。本机进程发出的数据包首先进行路由选择，经过<code>OUTPUT</code>链后，到达<code>POSTROUTING</code>链（可能发生数据包的源地址转换）。</p><h2 id="iptables的基本使用" tabindex="-1"><a class="header-anchor" href="#iptables的基本使用"><span>iptables的基本使用</span></a></h2><h3 id="规则查询" tabindex="-1"><a class="header-anchor" href="#规则查询"><span>规则查询</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># iptables --line-number -t filter -nvxL INPUT</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">750</span> packets, <span class="token number">50472</span> bytes<span class="token punctuation">)</span>
num    pkts    bytes    target    prot    opt    <span class="token keyword">in</span>    out    <span class="token builtin class-name">source</span>    destination          

<span class="token comment"># 选项</span>
<span class="token comment"># --line-number 显示行号</span>
<span class="token comment"># -t 指定表，默认为filter表</span>
<span class="token comment"># -n 直接显示IP地址</span>
<span class="token comment"># -v 显示详细信息</span>
<span class="token comment"># -x 显示精确的收发包大小</span>
<span class="token comment"># -L 指定链，不指定链名默认所有链</span>
<span class="token comment"># </span>
<span class="token comment"># 结果</span>
<span class="token comment"># policy 当前链的默认策略</span>
<span class="token comment"># pkts 当前链默认策略匹配到的包的数量</span>
<span class="token comment"># bytes 当前链默认策略匹配到的包的大小总和</span>
<span class="token comment"># num 行号</span>
<span class="token comment"># pkts 当前规则匹配到的数据包数量</span>
<span class="token comment"># bytes 当前规则匹配到的数据包大小总和</span>
<span class="token comment"># target 当前规则的效果</span>
<span class="token comment"># prot 当前规则的匹配的数据包网络协议</span>
<span class="token comment"># opt </span>
<span class="token comment"># in</span>
<span class="token comment"># out</span>
<span class="token comment"># source 源地址</span>
<span class="token comment"># destination 目的地址</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="规则管理" tabindex="-1"><a class="header-anchor" href="#规则管理"><span>规则管理</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># iptables -t filter -I INPUT -s 192.168.1.146 -j REJECT</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># iptables -nvxL INPUT</span>
Chain INPUT <span class="token punctuation">(</span>policy ACCEPT <span class="token number">49</span> packets, <span class="token number">2900</span> bytes<span class="token punctuation">)</span>
pkts  bytes  target  prot  opt  <span class="token keyword">in</span>  out  <span class="token builtin class-name">source</span>         destination         
<span class="token number">0</span>     <span class="token number">0</span>      REJECT  all   --   *   *    <span class="token number">192.168</span>.1.146  <span class="token number">0.0</span>.0.0/0     reject-with icmp-port-unreachable

<span class="token comment"># -t 指定表名，默认为filter表</span>
<span class="token comment"># 规则管理动作：-I 首部插入  -A 尾部追加  -D 删除  -F 刷新链(删除链中所有规则)  -R 修改规则(必须指定原匹配条件和匹配效果)</span>
<span class="token comment"># 规则匹配条件: -s 源IP　-d 目的IP  </span>
<span class="token comment"># -j 规则效果: ACCEPT通过  DROP丢弃  REJECT拒绝</span>

<span class="token comment"># 修改链的默认规则效果</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># iptables -P FORWARD DROP</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># iptables -nvxL FORWARD</span>
Chain FORWARD <span class="token punctuation">(</span>policy DROP <span class="token number">0</span> packets, <span class="token number">0</span> bytes<span class="token punctuation">)</span>
pkts    bytes    target    prot    opt    <span class="token keyword">in</span>    out    <span class="token builtin class-name">source</span>    destination

<span class="token comment"># 保存规则</span>
<span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># iptables-save &gt; /etc/sysconfig/iptables</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="规则匹配条件" tabindex="-1"><a class="header-anchor" href="#规则匹配条件"><span>规则匹配条件</span></a></h2><h3 id="基本匹配条件" tabindex="-1"><a class="header-anchor" href="#基本匹配条件"><span>基本匹配条件</span></a></h3><ol><li>源IP/目的IP地址</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 指定单个地址</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT -s<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token number">192.168</span>.4.129 <span class="token parameter variable">-j</span> DROP
<span class="token comment"># 指定多个地址</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT -s<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token number">192.168</span>.4.129,192.168.4.130 <span class="token parameter variable">-j</span> DROP
<span class="token comment"># 指定网段</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT -s<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token number">192.168</span>.4.0.0/16 <span class="token parameter variable">-j</span> DROP
<span class="token comment"># 取反</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token operator">!</span> -s<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token number">192.168</span>.4.129 <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>假设在空的INPUT链中添加如下规则：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token operator">!</span> <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.4.129 <span class="token parameter variable">-j</span> DROP
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>那么当IP为192.168.4.129的主机ping本机时，首先对比源IP和规则中的IP，发现不符合规则的匹配条件，会进入INPUT链的默认处理策略，即ACCEPT，因此IP为192.168.4.129的主机可以收到ICMP响应包。</p></div><ol start="2"><li>协议类型</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.4.129 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># iptables支持的协议类型</span>
<span class="token comment"># tcp, udp, udplite, icmp, icmpv6,esp, ah, sctp, mh 不指定协议时默认匹配所有协议</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>网卡接口</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-i</span> eth0 <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># -i 匹配数据包流入网卡，只能用于PREROUTING、INPUT、FORWARD链</span>
<span class="token comment"># -o 匹配数据包流出网卡，只能用于OUTPUT、FORWARD、POSTROUTING链</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="扩展匹配条件" tabindex="-1"><a class="header-anchor" href="#扩展匹配条件"><span>扩展匹配条件</span></a></h3><p>上面讲的都是iptables的基本匹配条件，端口号属于扩展匹配条件。对于基本匹配条件，如果需要使用扩展匹配条件，则需要一些扩展模块的支持。</p><ol><li>tcp扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 端口号</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.4.129 <span class="token parameter variable">-p</span> tcp <span class="token punctuation">[</span>-m tcp<span class="token punctuation">]</span> <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> REJECT
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.4.129 <span class="token parameter variable">-p</span> udp <span class="token punctuation">[</span>-m udp<span class="token punctuation">]</span> <span class="token parameter variable">--sport</span> <span class="token number">30000</span>:36655 <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># -m 指定扩展模块名，如不指定，会默认使用-m 协议名</span>
<span class="token comment"># --dport/--sport 指定端口范围</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-s</span> <span class="token number">192.168</span>.4.129 <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> mutiport <span class="token parameter variable">--dport</span> <span class="token number">22,23</span>:25 <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># -m mutiport 扩展模块可以同时指定多个离散的端口或端口范围</span>

<span class="token comment"># TCP标志位</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">-m</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> --tcp-flags SYN,ACK,FIN,RST,URG,PSH<span class="token punctuation">[</span>ALL<span class="token punctuation">]</span> SYN <span class="token parameter variable">-j</span> REJCET
<span class="token comment"># --tcp-flags 指定了TCP报文中的标志位。第一个参数表示要匹配报文TCP头中的哪些标志位，第二个参数表示第一个参数列表中标志位必须为1的标志(其他标志必须为0)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>udp扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> udp <span class="token parameter variable">-m</span> udp <span class="token parameter variable">--dport</span> <span class="token number">137</span> <span class="token parameter variable">-j</span> REJECT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>icmp扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-m</span> icmp --icmp-type <span class="token number">8</span>/0 <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># --icmp-type 指定icmp报文类型，8表示icmp type，0表示icmp code</span>
<span class="token comment">#  https://tools.ietf.org/html/rfc792</span>
<span class="token comment">#  https://zh.wikipedia.org/wiki/%E4%BA%92%E8%81%94%E7%BD%91%E6%8E%A7%E5%88%B6%E6%B6%88%E6%81%AF%E5%8D%8F%E8%AE%AE</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>iprange扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-m</span> iprange --src-range <span class="token number">192.168</span>.4.127-192.168.4.131 <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># iprange模块匹配数据包的源IP或目的IP地址范围(--dst-range)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>string扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-m</span> string <span class="token parameter variable">--algo</span> bm <span class="token parameter variable">--string</span> <span class="token string">&quot;OOXX&quot;</span> <span class="token parameter variable">-j</span> REJCET
<span class="token comment"># string模块用于匹配字符串</span>
<span class="token comment"># --algo 指定算法，支持bm算法或kmp算法</span>
<span class="token comment"># --string 指定待匹配的字符串</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>time扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-m</span> <span class="token function">time</span> <span class="token parameter variable">--timestart</span> 09:00:00 <span class="token parameter variable">--timestop</span> <span class="token number">11</span>:00:00 <span class="token parameter variable">--weekdays</span> <span class="token number">1,2</span>,3,4,5 <span class="token parameter variable">--monthdays</span> <span class="token number">22,23</span>,24 <span class="token parameter variable">--datestart</span> <span class="token number">2020</span>-07-01 <span class="token parameter variable">--datestop</span> <span class="token number">2020</span>-09-01 <span class="token parameter variable">-j</span> REJCET
<span class="token comment"># time 模块用于匹配时间</span>
<span class="token comment"># --timestart/--timestop 指定一天内的时间段</span>
<span class="token comment"># --weekdays/--monthdays 指定一周/月内的哪几天</span>
<span class="token comment"># --datestart/--datestop 指定起始和结束日期</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li>connlimit扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-m</span> connlimit --connlimit-above <span class="token number">2</span> --connlimit-mask <span class="token number">24</span> <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># connlimit 模块用于设置连接数限制</span>
<span class="token comment"># --connlimit-above 指定每个客户IP的并发连接数上限</span>
<span class="token comment"># --connlimit-mask 指定客户IP的网段(掩码长度)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="8"><li>limit扩展</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 假设现在要设置这样一条规则：每6s响应1次(1min响应10次)icmp报文</span>

<span class="token comment"># 方式一</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-m</span> limit <span class="token parameter variable">--limit</span> <span class="token number">10</span>/minute <span class="token parameter variable">-j</span> ACCEPT
<span class="token comment"># limit 模块提供了速率限制功能</span>
<span class="token comment"># --limit 指定匹配时间间隔</span>
<span class="token comment"># 效果一：第6秒的报文匹配到了该规则，执行了放行操作；而第6秒前的报文没有匹配到该规则，会执行默认策略即ACCEPT，也就是说该规则实际上没有起到任何效果</span>

<span class="token comment"># 方式二</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-m</span> limit <span class="token parameter variable">--limit</span> <span class="token number">10</span>/minute <span class="token parameter variable">-j</span> ACCEPT
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPIT <span class="token parameter variable">-p</span> icmp <span class="token parameter variable">-j</span> REJECT
<span class="token comment"># 效果二：只有被第一条规则匹配的到数据包会放行，其余的被REJECT掉，能够实现限流的功能。但实际测试会发现前5个报文没有被限流(都被放行了)，原因在于limit模块默认参数--limit-burst=5。该参数与令牌桶算法有关。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">令牌桶算法</p><p>有一个木桶，木桶里面放了5块令牌（–limit-burst），所有报文如果想要出关入关，都必须要持有木桶中的令牌才行，这个木桶每隔6秒钟会生成一块新的令牌。如果木桶中的令牌不足5块，新生成的令牌会被放入木桶中，否则令牌被丢弃。如果此时有5个报文想要入关，恰好这5个报文能在木桶里找到一人一个令牌，于是报文被放行；此时木桶中已经没有令牌可以使用了，因此剩余的报文被拒绝。但每6秒钟，会生成新的令牌，新的报文获取到该令牌后，再此被放行。令牌可积累，但木桶最多能存放的令牌数只有5个。</p></div><h2 id="规则动作" tabindex="-1"><a class="header-anchor" href="#规则动作"><span>规则动作</span></a></h2><p>规则动作也包括基础动作与扩展动作，与扩展匹配条件不同，扩展动作可以直接使用，而不需要指定特定模块。</p><h3 id="基础动作" tabindex="-1"><a class="header-anchor" href="#基础动作"><span>基础动作</span></a></h3><ol><li>ACCEPT</li><li>DROP</li></ol><h3 id="扩展动作" tabindex="-1"><a class="header-anchor" href="#扩展动作"><span>扩展动作</span></a></h3><ol><li>REJECT</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> REJECT --reject-with icmp-host-unreachable
<span class="token comment"># --reject-with 指定拒绝提示信息，默认为icmp-host-unreachable</span>
<span class="token comment"># 可用值如下：icmp-net-unreachable/icmp-host-unreachable/icmp-port-unreachable</span>
<span class="token comment"># icmp-proto-unreachable/icmp-net-prohibited/icmp-host-pro-hibited/icmp-admin-prohibited</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>LOG</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> filter - I INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">22</span> <span class="token parameter variable">-j</span> LOG --log-level info --log-prefix <span class="token string">&quot;log in from port 22&quot;</span>
<span class="token comment"># LOG动作会把符合条件的请求记录到日志中，默认的日志地址为/var/log/messages</span>
<span class="token comment"># 修改日志地址：/etc/rsylog.conf文件中添加kern.warning /var/log/iptables.log，重起systemctl restart rsyslog</span>
<span class="token comment"># --log-level 指定日志级别，可选值：emerg/alert/crit/error/warning/notice/info/debug</span>
<span class="token comment"># --log-prefix 指定日志前缀(标签)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>NAT</li></ol><div class="hint-container info"><p class="hint-container-title">网络地址转换</p><p>假设网络内部有10台主机，它们有各自的IP地址，当网络内部的主机与其他网络中的主机通讯时，则会暴露自己的IP地址，如果我们想要隐藏这些主机的IP地址，该怎么办呢？</p><p>当网络内部的主机向网络外部主机发送报文时，报文会经过防火墙或路由器，当报文经过防火墙或路由器时，将报文的源IP修改为防火墙或者路由器的IP地址，当其他网络中的主机收到这些报文时，显示的源IP地址则是路由器或者防火墙的，而不是那10台主机的IP地址，这样，就起到隐藏网络内部主机IP的作用，当网络内部主机的报文经过路由器时，路由器会维护一张NAT表，表中记录了报文来自于哪个内部主机的哪个进程（内部主机IP+端口），当报文经过路由器时，路由器会将报文的内部主机源IP替换为路由器的IP地址，把源端口也映射为某个端口，NAT表会把这种对应关系记录下来。</p><p>示意关系如下： <img src="`+t+`" alt="网络地址转换" loading="lazy"> 于是，外部主机收到报文时，源IP与源端口显示的都是路由的IP与端口，当外部网络中的主机进行回应时，外部主机将响应报文发送给路由器，路由器根据刚才NAT表中的映射记录，将响应报文中的目标IP与目标端口再改为内部主机的IP与端口号，然后再将响应报文发送给内部网络中的主机。整个过程中，外部主机都不知道内部主机的IP地址，内部主机还能与外部主机通讯，于是起到了隐藏网络内主机IP的作用。</p><p>内部网络的报文发送出去时，报文的源IP会被修改，也就是源地址转换：Source Network Address Translation，缩写为SNAT。</p><p>外部网络的报文响应时，响应报文的目标IP会再次被修改，也就是目标地址转换：Destinationnetwork address translation，缩写为DNAT。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">10.1</span>.0.0/16 <span class="token parameter variable">-j</span> SNAT --to-source public-IP
<span class="token comment"># SNAT动作只能配置在POSTROUTING、OUTPUT、FORWARD链上</span>
<span class="token comment"># --to-source 指定源IP(公网IP)</span>

iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-I</span> PREROUTING <span class="token parameter variable">-d</span> public-IP <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> public-PORT <span class="token parameter variable">-j</span> DNAT --to-destination private-IP:private-PORT
iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">10.1</span>.0.0/16 <span class="token parameter variable">-j</span> SNAT --to-source public-IP
<span class="token comment"># DNAT动作只能配置在PREROUTING、INPUT、FORWARD链上</span>
<span class="token comment"># --to-destination 指定目的IP(私网IP)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><ol start="4"><li>MASQUERADE</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> POSTROUTING <span class="token parameter variable">-s</span> <span class="token number">10.1</span>.0.0/16 <span class="token parameter variable">-o</span> eth0 <span class="token parameter variable">-j</span> MASQUERADE
<span class="token comment"># MASQUERADE 动态获取有效IP</span>
<span class="token comment"># -o 指定从那个网卡获取IP</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>REDIRECT</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> PREROUTING <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> REDIRECT --to-ports <span class="token number">8080</span>
<span class="token comment"># REDIRECT 端口映射，只能定义在PREROUTING链或者OUTPUT链中</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>自定义链 当iptables链中的规则很多时，非常难以管理，比如在大量的规则中有些是针对httpd服务的，有些是针对sshd服务的，有针对私网IP的，有针对公网IP的。如果修改一条规则需要查看其他所有规则的话，将会大大降低效率，因此iptables提供了自定义链的能力。但自定义链并不能直接使用，而是需要被默认链引用才能够使用。</li></ol><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 在filter表中创建IN_WEB自定义链</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-N</span> IN_WEB
<span class="token comment"># 在INPUT链中引用自定义链</span>
iptables <span class="token parameter variable">-t</span> filter <span class="token parameter variable">-I</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">80</span> <span class="token parameter variable">-j</span> IN_WEB
<span class="token comment"># 重命名自定义链</span>
iptables <span class="token parameter variable">-E</span> IN_WEB WEB
<span class="token comment"># 删除引用计数为0并且不包含任何规则的自定义链</span>
iptables <span class="token parameter variable">-X</span> WEB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>https://www.cnblogs.com/Gdavid/p/16718478.html</p>`,64),r=[p];function c(o,d){return s(),e("div",null,r)}const v=a(i,[["render",c],["__file","iptables.html.vue"]]),u=JSON.parse('{"path":"/software/linux/iptables.html","title":"iptables详解","lang":"zh-CN","frontmatter":{"title":"iptables详解","catalog":"Linux","description":"iptables的基本原理 概念 我们通常所说的iptables严格来讲应该叫做Netfilter，Netfilter是一种内核防火墙框架，可以实现很多网络安全策略，包括数据包过滤、数据包处理、地址伪装、透明代理、网络地址转换等。iptables则是一个应用层的二进制工具，可以基于Netfilter接口设置内核中的Netfilter配置表。 iptab...","head":[["meta",{"property":"og:url","content":"https://yuhaoxiang.github.io/work-blog/work-blog/software/linux/iptables.html"}],["meta",{"property":"og:site_name","content":"大杂烩"}],["meta",{"property":"og:title","content":"iptables详解"}],["meta",{"property":"og:description","content":"iptables的基本原理 概念 我们通常所说的iptables严格来讲应该叫做Netfilter，Netfilter是一种内核防火墙框架，可以实现很多网络安全策略，包括数据包过滤、数据包处理、地址伪装、透明代理、网络地址转换等。iptables则是一个应用层的二进制工具，可以基于Netfilter接口设置内核中的Netfilter配置表。 iptab..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-15T01:10:45.000Z"}],["meta",{"property":"article:author","content":"yhx"}],["meta",{"property":"article:modified_time","content":"2024-11-15T01:10:45.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"iptables详解\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-15T01:10:45.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yhx\\",\\"url\\":\\"/\\"}]}"]]},"headers":[{"level":2,"title":"iptables的基本原理","slug":"iptables的基本原理","link":"#iptables的基本原理","children":[{"level":3,"title":"概念","slug":"概念","link":"#概念","children":[]},{"level":3,"title":"iptables的表和链","slug":"iptables的表和链","link":"#iptables的表和链","children":[]},{"level":3,"title":"iptables原理图","slug":"iptables原理图","link":"#iptables原理图","children":[]}]},{"level":2,"title":"iptables的基本使用","slug":"iptables的基本使用","link":"#iptables的基本使用","children":[{"level":3,"title":"规则查询","slug":"规则查询","link":"#规则查询","children":[]},{"level":3,"title":"规则管理","slug":"规则管理","link":"#规则管理","children":[]}]},{"level":2,"title":"规则匹配条件","slug":"规则匹配条件","link":"#规则匹配条件","children":[{"level":3,"title":"基本匹配条件","slug":"基本匹配条件","link":"#基本匹配条件","children":[]},{"level":3,"title":"扩展匹配条件","slug":"扩展匹配条件","link":"#扩展匹配条件","children":[]}]},{"level":2,"title":"规则动作","slug":"规则动作","link":"#规则动作","children":[{"level":3,"title":"基础动作","slug":"基础动作","link":"#基础动作","children":[]},{"level":3,"title":"扩展动作","slug":"扩展动作","link":"#扩展动作","children":[]}]}],"git":{"createdTime":1714294039000,"updatedTime":1731633045000,"contributors":[{"name":"haoxiang.yu@sectrend.com.cn","email":"ZLJw5dEMQLaVgsP","commits":1},{"name":"余浩翔","email":"1x2_ou6tn9m4r4@dingtalk.com","commits":1}]},"readingTime":{"minutes":12.42,"words":3726},"filePathRelative":"software/linux/iptables.md","localizedDate":"2024年4月28日","autoDesc":true}');export{v as comp,u as data};
